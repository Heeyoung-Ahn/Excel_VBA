Attribute VB_Name = "check_user"

'통합문서 모듈에
Option Explicit

'------------------------------
'  사용자 이름 지정
'  사용자 이름 등록 확인
'------------------------------
Private Sub Workbook_Open()
    
    '//프로그램 사용자 이름 설정
    Call setUserName(Application.UserName)
    
    '//사용자 이름 등록 여부 확인: 등록되지 않은 사용자는 워크북 종료
    If checkUserName(Application.UserName) = False Then
        MsgBox "'" & Application.UserName & "'님은 프로그램 사용자로 등록되어 있지 않습니다." & vbNewLine & _
            "엑셀 파일을 종료합니다.", vbCritical, banner
        ThisWorkbook.Close savechanges:=False
    Else
        MsgBox "'" & Application.UserName & "'님은 프로그램 사용자로 확인되었습니다." & vbNewLine & _
            "이 파일을 정상적으로 사용할 수 있습니다.", vbInformation, banner
    End If
End Sub

'일반 모듈에
Option Explicit

Sub setUserName(userNM As String)

    If MsgBox("이 프로그램에서 사용할 사용자의 이름을 " & userNM & "으로 하겠습니까?", vbQuestion + vbYesNo, banner) = vbNo Then
        Do
            Application.UserName = InputBox("담당자의 이름을 입력해 주세요.", banner, Application.UserName)
            userNM = Application.UserName
        Loop Until userNM <> vbNullString
    End If
    MsgBox "이 프로그램 사용자의 이름을 '" & userNM & "'으로 지정하였습니다.", vbInformation, banner

End Sub

'일반 모듈에
Option Explicit
Public Const banner As String = "엑셀VBA샘플(사용자체크)"

'------------------------
'  등록된 사용자 체크
'------------------------
Function checkUserName(argUserNM As String) As Boolean
    Dim registeredUser As Variant
    Dim userNM As Variant
    
    registeredUser = Array("안희영", "김성실", "이열심")
    
    For Each userNM In registeredUser
        If userNM = argUserNM Then
            checkUserName = True
            Exit For
        Else
            checkUserName = False
        End If
    Next userNM
End Function
